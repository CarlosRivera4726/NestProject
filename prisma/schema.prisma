// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["relationJoins"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum PersonaRol {
  ADMIN
  PERSONA
  USUARIO
  INSPECTOR
  DEVELOPER
  VIEWER
}

enum StatusLocation {
  AVAILABLE
  UNAVAILABLE
}

enum StatusInspection {
  AVAILABLE
  UNAVAILABLE
}

model Persona {
  id            Int             @id @default(autoincrement())
  email         String          @unique
  name          String
  password      String
  role          PersonaRol      @default(DEVELOPER)
  created_at    DateTime        @default(now())
  updated_at    DateTime?       @default(now()) @updatedAt
  Inspector     Inspector[]
  Administrador Administrador[]
  Usuario       Usuario[]
}

model Inspector {
  id         Int          @id @default(autoincrement())
  persona    Persona      @relation(fields: [personaId], references: [id])
  personaId  Int          @unique
  created_at DateTime     @default(now())
  updated_at DateTime     @default(now()) @updatedAt
  Inspection Inspection[]
  Location   Location?    @relation(fields: [locationId], references: [id])
  locationId Int?
}

model Administrador {
  id         Int      @id @default(autoincrement())
  persona    Persona  @relation(fields: [personaId], references: [id])
  personaId  Int      @unique
  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt
}

model Usuario {
  id         Int          @id @default(autoincrement())
  persona    Persona      @relation(fields: [personaId], references: [id])
  personaId  Int          @unique
  created_at DateTime     @default(now())
  updated_at DateTime     @default(now()) @updatedAt
  Inspection Inspection[]
}

model Location {
  id          Int            @id @default(autoincrement())
  name        String
  coordinates String
  status      StatusLocation @default(AVAILABLE)
  created_at  DateTime       @default(now())
  updated_at  DateTime       @default(now()) @updatedAt
  Inspector   Inspector[]
  Inspection  Inspection[]
}

model Inspection {
  id          Int              @id @default(autoincrement())
  name        String
  status      StatusInspection @default(AVAILABLE)
  location    Location         @relation(fields: [locationId], references: [id])
  locationId  Int
  inspector   Inspector        @relation(fields: [inspectorId], references: [id])
  inspectorId Int
  usuario     Usuario          @relation(fields: [usuarioId], references: [id])
  usuarioId   Int
  created_at  DateTime         @default(now())
  updated_at  DateTime         @updatedAt
}

model MpPayment {
  id                 BigInt    @id
  date_created       DateTime? @db.Timestamptz
  date_approved      DateTime? @db.Timestamptz
  date_last_updated  DateTime? @db.Timestamptz
  date_of_expiration DateTime? @db.Timestamptz
  money_release_date DateTime? @db.Timestamptz

  money_release_status String?
  operation_type       String?
  issuer_id            String?
  payment_method_id    String?
  payment_type_id      String?
  status               String?
  status_detail        String?
  currency_id          String?
  description          String?
  live_mode            Boolean?
  sponsor_id           BigInt?
  authorization_code   String?
  taxes_amount         Decimal? @db.Decimal(18, 2)
  counter_currency     String?
  brand_id             String?
  shipping_amount      Decimal? @db.Decimal(18, 2)
  build_version        String?
  pos_id               String?
  store_id             String?
  integrator_id        String?
  platform_id          String?
  corporation_id       String?

  collector_id      BigInt?
  marketplace_owner String?

  external_reference          String?
  transaction_amount          Decimal? @db.Decimal(18, 2)
  net_amount                  Decimal? @db.Decimal(18, 2)
  transaction_amount_refunded Decimal? @db.Decimal(18, 2)
  coupon_amount               Decimal? @db.Decimal(18, 2)
  differential_pricing_id     String?
  financing_group             String?
  deduction_schema            String?
  installments                Int?

  captured              Boolean?
  binary_mode           Boolean?
  call_for_authorize_id String?
  statement_descriptor  String?
  processing_mode       String?
  merchant_account_id   String?
  merchant_number       String?

  notification_url String?

  payment_method          Json?
  charges_execution_info  Json?
  payer                   Json?
  metadata                Json?
  additional_info         Json?
  order_json              Json?
  taxes                   Json?
  transaction_details     Json?
  fee_details             Json?
  charges_details         Json?
  refunds                 Json?
  acquirer_reconciliation Json?
  point_of_interaction    Json?
  tax_info                Json?
  api_response            Json?

  api_status  Int?
  api_headers Json?

  created_at DateTime @default(now()) @db.Timestamptz

  @@map("mp_payments")
}
